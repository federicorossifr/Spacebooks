<h1>Fragments</h1>
<link rel="stylesheet" type="text/css" href="css/test.css">
<div class="fragmentContainer" id="myFragmentContainer">

	<form data-fragment data-name="Form">
		<label>Form input </label><br>
		<input type="text"><br>
		<label>Form file</label><br>
		<input type="file"><br>
	</form>

	<div data-fragment data-name="Div">
		<h3>My fragment is a div</h3>
		<p>My fragment is a div and it has a p</p>
	</div>

	<div data-fragment data-name="Cosino">
		<h3>Cosino era simpatico si</h3>
	</div>



</div>

<script type="text/javascript">

	function Fragment(container,callback) {
		this.container = document.getElementById(container);
		this.fragments = this.container.querySelectorAll("*[data-fragment]");
		this.controllerBar = document.createElement("div");
		this.controllerBar.className = "controllerBar";
		this.queueSize = this.fragments.length;
		this.pointer = 2;
		this.onFragmentChange = callback;
		with(this) {
			for(var index in fragments) {
				if(!isNaN(index) && index != pointer) {
					fragments[index].style.display = "none";
				}
			}
		}

	}

	Fragment.prototype.makeSelectors = function(nodeType) {
		with(this) {
			for(var index = 0; index < fragments.length && !isNaN(index); ++index) {
				var frgBtn = document.createElement(nodeType);
				frgBtn.className = "controller";
				frgBtn.setAttribute("data-toggle",index);
				var btnLabel = document.createTextNode(fragments[index].getAttribute("data-name"));
				frgBtn.appendChild(btnLabel);
				frgBtn.onclick = function() {that(this.getAttribute("data-toggle"));}
				controllerBar.appendChild(frgBtn);
			}
			container.insertBefore(controllerBar,fragments[0]);
			return  controllerBar;
		}
	}

	Fragment.prototype.makeShifters = function(nodeType,textNext,textPrev) {
		with(this) {

			var nextButton = document.createElement(nodeType);
			var prevButton = document.createElement(nodeType);
			var nextLabel = document.createTextNode(textNext);
			var prevLabel = document.createTextNode(textPrev);

			nextButton.appendChild(nextLabel);
			prevButton.appendChild(prevLabel);

			nextButton.setAttribute("data-role","nextFragment");
			prevButton.setAttribute("data-role","prevFragment");

			nextButton.className = "controller";
			prevButton.className = "controller";

			nextButton.onclick = function() {next()};
			prevButton.onclick = function() {prev()};

			controllerBar.appendChild(nextButton);
			controllerBar.insertBefore(prevButton,controllerBar.firstChild);
		}
	}

	Fragment.prototype.next = function() {
		with(this) {
			var btns = controllerBar.querySelectorAll("*[data-toggle]");
			btns[pointer].className = "controller";

			fragments[pointer].style.display = "none";
			pointer = (pointer+1) % queueSize;
			fragments[pointer].style.display = "block";

			btns[pointer].className = "controller active";
		}
	}

	Fragment.prototype.prev = function() {
		with(this) {
			var btns = controllerBar.querySelectorAll("*[data-toggle]");
			btns[pointer].className = "controller";

			fragments[pointer].style.display = "none";
			pointer = (pointer == 0) ? queueSize -1 : pointer - 1;
			fragments[pointer].style.display = "block";

			btns[pointer].className = "controller active";

		}
	}

	Fragment.prototype.that = function(index) {
		with(this) {
			var btns = controllerBar.querySelectorAll("*[data-toggle]");
			btns[pointer].className = "controller";

			fragments[pointer].style.display = "none";
			pointer = (index < queueSize) ? index : 0;
			fragments[pointer].style.display = "block";
			onFragmentChange(index);

			btns[pointer].className = "controller active";

		}
	}

	var ff = new Fragment("myFragmentContainer",function(p){console.log(p);});
	var s = ff.makeSelectors("button");
	ff.makeShifters("button","Next","Prev",s);


</script>