<h1>Fragments</h1>

<div class="fragmentContainer" id="myFragmentContainer">

	<form data-fragment data-name="Form">
		<label>Form input </label><br>
		<input type="text"><br>
		<label>Form file</label><br>
		<input type="file"><br>
	</form>

	<div data-fragment data-name="Div">
		<h3>My fragment is a div</h3>
		<p>My fragment is a div and it has a p</p>
	</div>

	<img data-fragment data-name="Img" src="img/default.jpg">



</div>

<script type="text/javascript">

	function Fragment(container,callback) {
		this.container = document.getElementById(container);
		this.fragments = this.container.querySelectorAll("*[data-fragment]");
		this.queueSize = this.fragments.length;
		this.pointer = 2;

		this.onFragmentChange = callback;

		with(this) {
			for(var index in fragments) {
				if(!isNaN(index) && index != pointer) {
					fragments[index].style.display = "none";
				}
			}
		}

	}

	Fragment.prototype.makeSelectors = function(nodeType) {
		with(this) {
			for(var index = 0; index < fragments.length && !isNaN(index); ++index) {
				var frgBtn = document.createElement(nodeType);
				frgBtn.setAttribute("data-toggle",index);
				var btnLabel = document.createTextNode(fragments[index].getAttribute("data-name"));
				frgBtn.appendChild(btnLabel);
				frgBtn.onclick = function() {that(this.getAttribute("data-toggle"));}
				container.appendChild(frgBtn);
			}
		}
	}

	Fragment.prototype.makeShifters = function(nodeType,textNext,textPrev) {
		with(this) {
			var nextButton = document.createElement(nodeType);
			var prevButton = document.createElement(nodeType);
			var nextLabel = document.createTextNode(textNext);
			var prevLabel = document.createTextNode(textPrev);

			nextButton.appendChild(nextLabel);
			prevButton.appendChild(prevLabel)

			nextButton.onclick = function() {next()};
			prevButton.onclick = function() {prev()};

			container.appendChild(prevButton);
			container.appendChild(nextButton);

		}
	}

	Fragment.prototype.next = function() {
		with(this) {
			fragments[pointer].style.display = "none";
			pointer = (pointer+1) % queueSize;
			fragments[pointer].style.display = "block";
		}
	}

	Fragment.prototype.prev = function() {
		with(this) {
			fragments[pointer].style.display = "none";
			pointer = (pointer == 0) ? queueSize -1 : pointer - 1;
			fragments[pointer].style.display = "block";
		}
	}

	Fragment.prototype.that = function(index) {
		with(this) {
			fragments[pointer].style.display = "none";
			pointer = (index < queueSize) ? index : 0;
			fragments[pointer].style.display = "block";
			onFragmentChange(index);
		}
	}

	var ff = new Fragment("myFragmentContainer",function(p){console.log(p);});
	ff.makeSelectors("button");
	ff.makeShifters("button",">","<");


</script>