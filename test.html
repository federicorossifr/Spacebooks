

<body onload="init()">
	<button id="get" >Get</button><img id="loader" src="./img/ajax-loader.gif" style="display:none">
	Content:
	<input type="text" id="filter">
	Field:
	<select id="field">
		<option value="0">Id</option>
		<option value="1">Name</option>
		<option value="2">Times</option>
		<option value="3">Last</option>
	</select>
	<table>
		<thead>
			<th>Id</th>
			<th>Name</th>
			<th>Times</th>
			<th>Last</th>
		</thead>

		<tbody id="out">
			
		</tbody>
	</table>
</body>

<script type="text/javascript" src="./js/Async.js"></script>

<script type="text/javascript">

	function matrixToTable(matrix,table) {
		var rows = table.rows;

		for(var index in matrix) {
			var matrixRow = matrix[index];
			var tmpRow = table.insertRow(rows.length);
			
			for(var prop in matrixRow ) {
				var tmpCell = tmpRow.insertCell(tmpRow.cells.length);
				tmpCell.textContent = matrixRow[prop];
			}
		}
	}

	function filterTable(table,field,text) {
		var rows = table.rows;
		var reg = new RegExp(text);
		for(var rowIndex in rows) {
			var cells = rows[rowIndex].cells;

			var tmpCell = cells[field];
			if(reg.test(tmpCell.textContent)) rows[rowIndex].style.display = "table-row";
				else rows[rowIndex].style.display = "none";
			}
	}



	function init() {
		var getter = new AsyncReq("./php/test.php",callback);
		var START = 0;
		var SIZE = 5;
		var loader = document.getElementById("loader");
		var filter = document.getElementById("filter");
		var field = document.getElementById("field");
		var dataTable = document.getElementById("out");
		var get = document.getElementById("get");
		get.onclick = getAndDisplay;
		
		function callback(data) {
			var jsonData = JSON.parse(data);
			console.log(data);
			matrixToTable(jsonData,dataTable);
			START+= jsonData.length;
			loader.style.display = "none";
		}

		function getAndDisplay() {
			loader.style.display = "inline";
			var params = [{'id':'fw','value':START},{'id':'hw','value':SIZE}];
			getter.GET(params);
		}

		filter.oninput = function(event) {
			var text = event.target.value;
			var fieldNumber = field.value;
			filterTable(dataTable,fieldNumber,text);
		}

		field.onchange = function(event) {
			var fieldNumber = event.target.value;
			var text = filter.value;
			filterTable(dataTable,fieldNumber,text);
		}
	}

	init();

</script>